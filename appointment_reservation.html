<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body>
<div class="container">
    <br>
    
    <h2>Saville Assessment</h2>
    <br>

		<div class="row mb-3">
		  <label for="colFormLabel" class="col-sm-2 col-form-label">Name</label>
		  <div class="col-sm-10">
		    <input type="text" class="form-control" id="colFormLabel" placeholder="name">
		  </div>
		</div>
		<div class="row mb-3">
		  <label for="colFormLabel" class="col-sm-2 col-form-label">ID</label>
		  <div class="col-sm-10">
		    <input type="number" class="form-control" id="colFormLabel" placeholder="id">
		  </div>
		</div>
		<div class="row mb-3">
		  <label for="colFormLabel" class="col-sm-2 col-form-label">Email</label>
		  <div class="col-sm-10">
		    <input type="email" class="form-control" id="colFormLabel" placeholder="email">
		  </div>
		</div>
		<div class="row mb-3">
		  <label for="colFormLabel" class="col-sm-2 col-form-label">Mobile</label>
		  <div class="col-sm-10">
		    <input type="number" class="form-control" id="colFormLabel" placeholder="mobile">
		  </div>
		</div>

    	<table class="table table-success table-striped">
    		<thead>
    			<th>22-7-2024</th>
    			<th>Session 1</th>
    			<th>Session 2</th>
    			<th>Session 3</th>
    			<th>Session 4</th>
    			<th>Session 5</th>
    		</thead>
    		<tbody>
    			<tr>
    				<th>Trainer 1 - Location a</th>
    				<td>
    					<input type="radio" name="entry.494977624" value="date_22_7_trainer_1_location_a_session_1"/>
    				</td>
    				<td>
    					<input type="radio" name="entry.494977624" value="date_22_7_trainer_1_location_a_session_2"/>
    				</td>
    				<td>
    					<input type="radio" name="entry.494977624" value="date_22_7_trainer_1_location_a_session_3"/>
    				</td>
    				<td>
    					<input type="radio" name="entry.494977624" value="date_22_7_trainer_1_location_a_session_4"/>
    				</td>
    				<td>
    					<input type="radio" name="entry.494977624" value="date_22_7_trainer_1_location_a_session_5"/>
    				</td>
    			</tr>
    			
    		</tbody>
		</table>
		<input type="button" class="submit_btn" value="submit" name="">
</div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>
  <script type="text/javascript">
  	
  	//get list of free slots
  	// download sheet to get options list
  	//https://docs.google.com/spreadsheet/ccc?key=1UKlY3zSDkNfVf9e0w3eYSaM8b2ft6RG3Y7rHviaVbBA&output=xls

  	const sheet_url = "https://docs.google.com/spreadsheet/ccc?key=1UKlY3zSDkNfVf9e0w3eYSaM8b2ft6RG3Y7rHviaVbBA&output=xlsx"
  	
  	getExcelFromUrl(sheet_url)


  	document.querySelector('.submit_btn').addEventListener('click', function(event){
  		event.preventDefault();

  		let selectedInput = document.querySelector('[name="entry.494977624"]:checked').value;

  		if(selectedInput!='' && selectedInput!='undefined')
  		window.open(`https://docs.google.com/forms/d/e/1FAIpQLScqCGZIb3RpTHFCqbHHUlwzLAi7_INyYDi9GvjSDB9cI9lLxw/viewform?usp=pp_url&entry.494977624=${selectedInput}`)

  	})


async function getExcelFromUrl(url)
{
	//let request = await fetch(url,{method: 'GET',mode: 'no-cors'});
	//let arraybuffer = await request.arrayBuffer();
	//console.log(arraybuffer);
	//readFile(arraybuffer)

	var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function () {
    if (this.readyState === 4 && this.status === 200) {
        //console.log('success', this.responseText.length);
	readFile(this.response)
    }
};
xhr.responseType="arraybuffer";
xhr.open('GET', 'https://docs.google.com/spreadsheet/ccc?key=1UKlY3zSDkNfVf9e0w3eYSaM8b2ft6RG3Y7rHviaVbBA&output=xlsx', true);
xhr.send(null);
}

function readFile(arrayBuffer){

    var reader = new FileReader();

    reader.onload = function(e) {
      /* convert data to binary string */
        var data = new Uint8Array(arrayBuffer);
      var workbook = XLSX.read(data, {
        type: 'binary'
      });

      workbook.SheetNames.forEach(function(sheetName) {
        // Here is your object
        var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
        var json_object = JSON.stringify(XL_row_object);
        console.log(json_object);

      })

    };

    reader.onerror = function(ex) {
      console.log(ex);
    };

    reader.readAsBinaryString(arrayBuffer);
  

}



  </script>
  </body>
</html>
